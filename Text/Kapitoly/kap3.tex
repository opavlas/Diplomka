\chapter{Timepix 2}
% v podstatě technická dokumentace Timepix 2, plus konkretni pozadavky pro provoz
\label{kap:3}
V předchozí kapitole, kapitole \ref{kap:2}, byly popsány obecné vlastnosti detektoru a základní principy detekce ionizujícího záření. V této kapitole bude detailněji popsán konkrétní detektor, detektor Timepix 2 \cite{tpx2_manual}. Timepix 2 patří do rodiny detektorů Timepix. Prvním z rodiny detektorů byl detektor Timepix \cite{Llopart}, následně to popořadě byly detektory Timepix 3 \cite{Timepix3}, Timepix 2 \cite{tpx2_manual}, \cite{Timepix2} a nejnovějším detektorem je Timepix 4 \cite{Timepix4}. Detektor Timepix 2 je zobrazen na obrázku \ref{fig:Timepix2}.
\begin{figure}[h!]
	\centering
	\captionsetup{justification=centering}
	\includegraphics[scale=0.55]{Timepix2.png}
	\caption{Detektor Timepix 2 \cite{Timepix2}} 
	\label{fig:Timepix2}
\end{figure}	


\section{Technická specifikace} %napáječky, kom. rozhraní, prikazy atd.., VN, hodiny pro měření, I/O piny
Timepix 2 je rozdělen do 256 x 256 pixelů. Rozteč mezi jednotlivými pixely je 55 $\mu$$m$. Celkově pak Timepix 2 má rozměry 16.6 x 14.14 mm. Detektor byl vyvinut pod záštitou CERN Medpipix Collaboration \cite{Medpix}. Vyčítací část detektoru tvoří ASCI chip navržen ve 130 nm CMOS technologii. Samotná výroba ASIC je zajišťována jedním z předních výrobců chipů, firmou TSMC \cite{TSMC} na Taiwanu. Všechny technické informace, nebude-li uvedeno jinak jsou čerpány z manuálu k detektoru Timepix 2 \cite{tpx2_manual}.

\subsection{Napájení}	
Timepix 2 ke své činnosti potřebuj celkem 3 napájení viz. tabulka \ref{tab:tpx2_napajeni}. Napájení VDD a VDDA slouží k napájení jádra Timepix 2, napájení VDDIO pak k napájení vstupních výstupních bran. Pokud chceme z Timepix 2 vyčíst CHIP ID, musíme na pin VDD33 aplikovat napájecí napětí 2.5 V. Při normální činnosti detektoru, je požadováno napětí 1.2 V. Celková spotřeba Timepix 2 při zapnutí všech pixelů a frekvenci datových hodin $f_{clock}$ = Mhz je dle \cite{Timepix2} nižší než 900 mW.
\begin{table}[h!]
	\centering
	\begin{tabular}{ |P{3cm}||P{5cm}|  }
		\hline
		\multicolumn{2}{|c|}{Napájecí úrovně Timepix 2} \\
		\hline
		Název pinu& Hodnota napájecího napětí [V] \\ \hline \hline 
		VDDIO & 2.5 \\ \hline		
		VDD & 1.2 \\ \hline 		 
		VDDA & 1.2 \\ \hline
		VDD33 & 2.5 (1.2)\\ \hline
	\end{tabular}
	\caption{Napájecí úrovně Timepix 2}
	\label{tab:tpx2_napajeni}
\end{table}

\par Speciální kategorií napájení je napájení pro zajištění vysokého napětí, které se připojí na senzorovou vrstvu. Toto napětí zajistí vyprázdnění oblasti v polovodičové struktuře. Požadavky na parametry vysokého napětí záleží na typu a tloušťce senzorové vrstvy.  

\subsection{Rozhraní pro připojení Timepix 2 k desce plošných spojů}	% TODO nazev
Připojení Timepix 2 k desce plošných spojů je nejčastěji realizováno pomocí technologie \textit{wire bonding}. Timepix 2 má celkem 152 pinů pro přichycení wire bondů. Rozložení pinů je zobrazeno na obrázku \ref{fig:tpx2_floorplan} ve spodní části. Rozteč mezi jednotlivými plošky je 108 $\mu$m.
\begin{figure}[h!]
	\centering
	\captionsetup{justification=centering}
	\includegraphics[scale=0.80]{tpx2_floorplan.png}
	\caption{Rozložení detektoru Timepix 2 \cite{tpx2_manual}} 
	\label{fig:tpx2_floorplan}
\end{figure}	
Dalším možným způsobem připojení Timepix 2 k desce plošných spojů je pomocí technologie zvané TSV. Respektive pomocí této technologie je možné signály vyvést ze zadní strany Timepix 2 k pájecím ploškám. Vznikne tím tak uspořádání, známe z technologie výroby pouzder BGA elektronických součástek. 
\par Běžnější způsob připojení Timepix 2 k desce plošných spojů je pomocí wire bondů. Použití wire bondů i technologie BGA je možné vidět na obrázku \ref{fig:bga}. Výhodou oproti technologii wire bondů je lepší praktické zacházení, díky absenci tenkých wire bondů, které jsou velmi náchylné na mechanické poškození. Další výhodou je poté technologicky méně náročné připojení detektoru. Avšak nevýhodou této technologie je vystavení chipu vysoké teplotě při pájení.
\begin{figure}[h!]
	\centering
	\captionsetup{justification=centering}
	\includegraphics[scale=0.55]{bga.jpg}
	\caption{Připojení detektoru Timepix 2 k desce plošných spojů \cite{TSV}} 
	\label{fig:bga}
\end{figure}	

\section{Komunikační rozhraní}
\subsection{Logické úrovně} 	% TODO nazev
\label{kap:3.2.1}
Timepix 2 umožňuje komunikaci po paraelním nebo sériovém datovém kanálu. Pro komunikaci přes paraelní bránu je možno využít 32 paraelních vodičů. Paraelní brána dosahuje násobně vyšších přenosových rychlostí, než sériový kanál, viz. obrázek \ref{fig:rychlosti}. Dosažením takovýchto rychlostí je zapotřebí na straně vyčítací elektroniky použít velmi rychlé rozhraní, například FPGA.  
\par Veškerá sériová komunikace probíhá po diferenciálních datových párech. Konkrétně se jedná o specifikaci SLVS \cite{SLVS}. Napěťové úrovně této specifikace lze najít na obrázku \ref{fig:SLVS_LVDS}. Jak lze na obrázku \ref{fig:SLVS_LVDS} vidět, specifikace SLVS je analogická se specifikací LVDS \cite{LVDS}. Výhody sériové komunikace jsou především v návrhu a spotřebě vyčítacího zařízení. Maximální datové rychlost, respektive rychlost komunikačních hodin je dle \cite{tpx2_manual} 100 Mhz. Lze tedy pro návrh použít například mikroprocesor. Hlavní nevýhodou sériové komunikace je oproti paraelní komunikaci vyčítací rychlost, která je násobně nižší \ref{fig:rychlosti}.
\begin{figure}[h!]
	\centering
	\captionsetup{justification=centering}
	\includegraphics[scale=0.55]{SLVS_LVDS.png}
	\caption{SLVS specifikace \cite{SLVS}} 
	\label{fig:SLVS_LVDS}
\end{figure}	
\begin{figure}[h!]
	\centering
	\captionsetup{justification=centering}
	\includegraphics[scale=0.40]{rychlosti.jpg}
	\caption{Vyčítací rychlosti snímků z Timepix2. Frekvence hodin $f_{clock}$ = 100 MHz \cite{tpx2_manual}} 
	\label{fig:rychlosti}
\end{figure}	

\subsection{Struktura komunikace}
V této podkapitole bude popsána struktura komunikace s Timepix 2 za použití sériové komunikace popsané v \ref{kap:3.2.1}.  
%TODO popis signalu SPI pro TPX2 a casovani. Zminit i pakety SET/GET a jejich strukturu? 
Komunikace s Timepix 2 se rozděluje na příkazy SET a GET. Příkazy SET nastavujeme příslušný registr a příkazy GET daný registr vyčítáme. 

%TODO signaly potrebne pro komunikaci, ale pak i dac out atd.. 

% TODO zminit potrebne HV

\section{Analogová část}
Každý jeden z 256 x 256 pixelů celé matice Timepix 2 je tvořen svojí vlastní analogovou částí. Jak bylo zmíněno v kapitole \ref{kap:2}, pokud částice interaguje na senzorové vrstvě dojde k vytvoření nábojového impulsu. Tento náboj je díky připojenému napětí přitažen k elektrodám. Tento náboj může být charakterizován jako Diracův proudový impuls. Integrací Diracovo proudového impulsu poté dostaneme celkový generovaný náboj Q. Diracův impuls je naintegrován do malého kapacitoru Cf. Poté na výstupu CSA je v ideálním případě napěťový skok s amplitudou Q/Cf. Výstupní puls je poté porovnán s komparační. Nastavením komparačním úrovně lze eliminovat zbytkový proud takzvaný \textit{leakage current} závěrného směru polovodičové struktury který zde vzniká kvůli připojenému vysokému napětí. Pokud je signál větší než daná nastavená úroveň, je inkrementován digitální čítač \cite{Llopart}. Každý diskriminátor obsahuje 5-bitový DAC převodník. Tento 5 bitový DAC převodník umožňuje nastavit úroveň detekovatelného signálu pro každý pixel individuálně a tím eliminovat šum. Analogické uspořádaní pro analogovou část lze vidět na obrázku \ref{fig:tpx2_cel}, kde je zobrazeno uspořádání jednoho pixelu detektoru Medipix 2.
\begin{figure}[h!]
	\centering
	\captionsetup{justification=centering}
	\includegraphics[scale=0.80]{tpx2_cel.jpg}
	\caption{Uspořádání jednoho pixelu} 
	\label{fig:tpx2_cel}
\end{figure}	

\section{Digitální část}
%TODO mody timepix 2
Každý pixel obsahuje čtyři digitální čítače typu LSFR. Každý n-bitový čítač generuje $2^n$ pseoudonáhodných čísel. V případě Timepix 2 každý pixel obsahuje dva 10-bitové (A,B) a dva 4-bitové (C,D) čítače. Například tedy 14-bitový čítač vznikne kombinací 10-bitového a 4-bitového čítače. Odpovídající 14-bitová hodnota je poté viz \ref{eq:1}. Celkem tedy pro každý pixel lze využít 28-bitů. Tyto čítače mouhou pracovat v různých módech. Tyto módy budou probrány v další části.
\begin{equation}
	14-bit = (hodnota_{4-bit} \cross 2^{10}) + hodnota_{10-bit}
	\label{eq:1}
\end{equation}

Jak bylo zmíněno výše. Každý z digitálních čítačů může být nakonfigurován do jiného módu. Pro Timepix 2 jsou to následující módy \ref{fig:modes}. 
\begin{itemize}
	\item \textbf{Time over Threshold} (ToT): Čítač je inkrementován při každým hodinovým pulsu, kdy je signál nad nastavenou prahovou úrovní
	\item \textbf{Time of Arrival} (ToA): Čítač je inkrementován při každým hodinovým pulsu, kdy signál překročí nastavenou úroveň a inkrementuje se až do konce akvizice.
	\item \textbf{Coutnig mode}: Čítač je inkrementován pokud signál překročí dvakrát nastavený práh, viz. obrázek \ref{fig:modes} 
\end{itemize}
\begin{figure}[h!]
	\centering
	\captionsetup{justification=centering}
	\includegraphics[scale=0.45]{modes.jpg}
	\caption{Digitální módy Timepix 2 \cite{Manek}} 
	\label{fig:modes}
\end{figure}	

Jakou energii interagující částice zanechala v senzoru můžeme zjistit z ToT měření. Počet hodinových cyklů odpovídá času, po který hodnota analogového napětí byla nad nastavenou detekovatelnou úrovní. Více o způsobu měření energie například viz. \cite{JAKUBEK2011S262}.

%TODO zminit ze countery mouhu ruzne kombinovat a zaroven jejich mody. PLUS zminit maskovani pixelu -> spotreba



 

